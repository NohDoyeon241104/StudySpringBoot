<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>My ToDo App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .completed { text-decoration: line-through; color: gray; }
    </style>
</head>
<body class="container mt-5">
    <h2 class="text-center mb-4">ğŸ“ My Todo List</h2>

    <div class="input-group mb-3">
        <input type="text" id="todoTitle" class="form-control" placeholder="í•  ì¼ì„ ì…ë ¥í•˜ì„¸ìš”...">
        <button class="btn btn-primary" onclick="addTodo()">ì¶”ê°€</button>
    </div>

    <table class="table table-hover">
        <thead class="table-light">
            <tr>
                <th>ìƒíƒœ</th>
                <th>í•  ì¼</th>
                <th>ìš°ì„ ìˆœìœ„</th>
                <th>ê´€ë¦¬</th>
            </tr>
        </thead>
        <tbody id="todoList">
            </tbody>
    </table>

    <script>
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¦‰ì‹œ ëª©ë¡ ì¡°íšŒ
        window.onload = function() {
            loadTodos();
        };

        // 1. ì„œë²„ì—ì„œ ëª©ë¡ ê°€ì ¸ì™€ì„œ í…Œì´ë¸”ì— í‘œì‹œ
        function loadTodos() {
            fetch('/api/todos')
                .then(function(response) { return response.json(); })
                .then(function(data) {
                    const todoList = document.getElementById('todoList');
                    todoList.innerHTML = '';
                    data.forEach(function(todo) {
                        todoList.innerHTML += `
                            <tr>
                                <td><input type="checkbox" ${todo.completed ? 'checked' : ''}></td>
                                <td class="${todo.completed ? 'completed' : ''}">${todo.title}</td>
                                <td>${todo.priority || '-'}</td>
                                <td><button class="btn btn-sm btn-danger">ì‚­ì œ</button></td>
                            </tr>`;
                    });
                })
                .catch(function(error) { console.error('Error:', error); });
        }

        // 2. ì„œë²„ë¡œ ìƒˆë¡œìš´ í•  ì¼ ì „ì†¡
        function addTodo() {
            const titleInput = document.getElementById('todoTitle');
            const title = titleInput.value;
            
            if (!title) {
                alert("ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”!");
                return;
            }

            fetch('/api/todos', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ title: title, completed: false })
            })
            .then(function(res) { return res.json(); })
            .then(function() {
                titleInput.value = ''; // ì…ë ¥ì°½ ì´ˆê¸°í™”
                loadTodos(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            })
            .catch(function(error) { alert("ì €ì¥ ì‹¤íŒ¨!"); });
        }
    </script>
</body>
</html>